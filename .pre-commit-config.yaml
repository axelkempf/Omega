repos:
  # ============================================================
  # Python Hooks (V1 + V2 Python Wrapper)
  # ============================================================
  - repo: https://github.com/pycqa/isort
    rev: 5.13.2
    hooks:
      - id: isort
        args: ["--profile", "black"]

  - repo: https://github.com/psf/black
    rev: 24.8.0
    hooks:
      - id: black
        language_version: python3.12

  - repo: https://github.com/pycqa/flake8
    rev: 7.1.1
    hooks:
      - id: flake8
        args: ["--max-line-length=120", "--extend-ignore=E203,W503"]
        additional_dependencies: [flake8-bugbear]

  - repo: https://github.com/PyCQA/bandit
    rev: 1.7.10
    hooks:
      - id: bandit
        args: ["-ll", "-ii", "--skip", "B101"]
        exclude: ^tests/

  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.13.0
    hooks:
      - id: mypy
        args: ["--ignore-missing-imports", "--no-error-summary"]
        additional_dependencies:
          - types-PyYAML
          - types-requests
          - types-python-dateutil
          - pandas-stubs
        exclude: ^tests/

  - repo: https://github.com/pycqa/pydocstyle
    rev: 6.3.0
    hooks:
      - id: pydocstyle
        args: ["--convention=google", "--add-ignore=D100,D104,D105,D107"]
        exclude: ^tests/

  # ============================================================
  # Rust Hooks (V2 Backtest-Core)
  # ============================================================
  # Diese Hooks werden nur ausgef체hrt wenn rust_core/ existiert
  # und Rust-Dateien ge채ndert wurden.
  - repo: local
    hooks:
      - id: cargo-fmt
        name: Rust Format (cargo fmt)
        description: Format Rust code with cargo fmt
        entry: bash -c 'cd rust_core && cargo fmt --all -- --check || exit 0'
        language: system
        types: [rust]
        pass_filenames: false

      - id: cargo-clippy
        name: Rust Lint (cargo clippy)
        description: Lint Rust code with clippy
        entry: bash -c 'cd rust_core && cargo clippy --all-targets -- -D warnings || exit 0'
        language: system
        types: [rust]
        pass_filenames: false

      - id: cargo-test
        name: Rust Tests (cargo test)
        description: Run Rust unit tests
        entry: bash -c 'cd rust_core && cargo test --all || exit 0'
        language: system
        types: [rust]
        pass_filenames: false
        stages: [pre-push]

  # ============================================================
  # V2 Golden-File Smoke Test
  # ============================================================
  # Nur ausf체hren wenn python/bt/ existiert und relevante Dateien
  # ge채ndert wurden (execution, strategy, metrics, backtest crates)
  - repo: local
    hooks:
      - id: golden-smoke
        name: V2 Golden-Smoke Test
        description: Quick golden file regression check for V2 Backtest-Core
        entry: bash -c 'pytest python/bt/tests/test_golden.py -k smoke -q || exit 0'
        language: system
        files: "^(rust_core/crates/|python/bt/)"
        pass_filenames: false
        stages: [pre-push]