# .flake8 - flake8 configuration

[flake8]
max-line-length = 120
extend-ignore =
    # E203: whitespace before ':' (conflicts with black)
    E203,
    # W503: line break before binary operator (conflicts with black)
    W503,
    # E402: module level import not at top of file (sometimes needed for conditional imports)
    E402,
    # E501: line too long (max-line-length handles this, but we're lenient for now)
    E501,
    # E731: do not assign lambda (sometimes needed for functional patterns)
    E731,
    # F401: imported but unused (sometimes imports are needed for type checking or re-exports)
    F401,
    # F403: wildcard imports (used in __init__.py for convenience exports)
    F403,
    # F541: f-string without placeholders (often used for consistency or future formatting)
    F541,
    # F811: redefinition of unused variable (sometimes needed for reimports or late binding)
    F811,
    # F824: global statement unused (sometimes needed for mypy or future use)
    F824,
    # F841: local variable assigned but never used (often used for unpacking or future debugging)
    F841,
    # C901: function too complex (we'll address complexity gradually)
    C901,
    # B007: Loop control variable not used (often intentional for unpacking)
    B007,
    # B008: Do not perform function calls in argument defaults (common pattern in Python)
    B008,
    # B009: getattr with constant attribute (sometimes needed for dynamic access patterns)
    B009,
    # B010: setattr with constant attribute (sometimes needed for dynamic patterns)
    B010,
    # B014: Redundant exception types (legacy error handling patterns)
    B014,
    # B023: Function definition does not bind loop variable (addressed case-by-case)
    B023,
    # B027: Empty method without @abstractmethod (sometimes intentional for base classes)
    B027,
    # B028: No explicit stacklevel in warnings.warn (not critical for now)
    B028,
    # B042: Exception __init__ should pass args to super (legacy code pattern)
    B042

exclude =
    .git,
    __pycache__,
    .venv,
    venv,
    .eggs,
    *.egg,
    build,
    dist,
    var,
    data,
    .mypy_cache,
    .pytest_cache,
    .tox,
    docs,
    reports,
    final_selection/joblib_tmp,
    src/omega.egg-info,
    src/julia_modules,
    src/rust_modules,
    stubs

# Per-file ignores for specific patterns
per-file-ignores =
    # Allow ambiguous 'l' variable in legacy analysis code
    src/backtest_engine/analysis/walkforward_analyzer.py:E741
    # Allow missing whitespace in type annotations (intentional for readability)
    src/hf_engine/core/execution/execution_engine.py:E231,
    src/backtest_engine/optimizer/robust_zone_analyzer.py:E231
    # Allow undefined 'Any' in performance tool (will be fixed separately)
    tools/perf_portfolio.py:F821

max-complexity = 15

# Note: If flake8-bugbear crashes on deep nested structures,
# you may need to temporarily disable bugbear checks or upgrade the plugin.
# To disable all bugbear: add 'B' to extend-ignore above.
